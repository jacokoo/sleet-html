!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("sleet"),require("fs"),require("path")):"function"==typeof define&&define.amd?define(["exports","sleet","fs","path"],t):t(e.SleetHTML={},e.Sleet,e.NODE_FS,e.NODE_PATH)}(this,function(e,u,r,o){"use strict";var a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),c=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},t=function(e){function n(){return a(this,n),l(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return c(n,e),s(n,[{key:"compile",value:function(e){this.tagOpen(e),this.content(e),this.tagClose(e)}},{key:"tagOpen",value:function(e){this.openStart(e),this.attributes(e),this.openEnd(e)}},{key:"openStart",value:function(e){e.eol().indent().push("<"),this.node.namespace&&e.push(this.node.namespace).push(":"),e.push(this.node.name||"div")}},{key:"attributes",value:function(i){var r=this,e=this.mergeAttributeGroup.apply(this,[i].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}([this.dotsAndHash()].concat(this.node.attributeGroups))));e.length&&i.push(" "),e.forEach(function(e,t){var n=i.compile(e,r.stack);n&&(t&&i.push(" "),n.mergeUp())})}},{key:"openEnd",value:function(e){e.push(">")}},{key:"content",value:function(t){var n=this;this.selfClosing()||this.node.children.forEach(function(e){return t.compileUp(e,n.stack)})}},{key:"tagClose",value:function(e){this.selfClosing()||(e.haveIndent&&e.eol().indent(),e.push("</"),this.node.namespace&&e.push(this.node.namespace).push(":"),e.push(this.node.name||"div").push(">"))}},{key:"selfClosing",value:function(){return!1}},{key:"dotsAndHash",value:function(){if(!this.node.hash&&!this.node.dots.length)return null;var e=this.node.location.start,t=void 0;t=this.node.attributeGroups.length?this.node.attributeGroups[0].location.start:this.node.location.end;var n={start:{offset:e.offset,line:e.line,column:e.column},end:{offset:t.offset,line:t.line,column:t.column}},i=[];if(this.node.hash){var r=[new u.StringValue(this.node.hash,n)];i.push(new u.Attribute(void 0,"id",r,n))}if(this.node.dots.length){var o=this.node.dots.map(function(e){return new u.StringValue(e,n)});i.push(new u.Attribute(void 0,"class",o,n))}return new u.AttributeGroup(i,void 0,n)}},{key:"mergeAttributeGroup",value:function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r=n.filter(function(e){return!!e});if(!r.length)return[];if(!1!==e.options.ignoreSetting)return[r.reduce(function(e,t){return e.merge(t,!0),e})];var o=r.filter(function(e){return!e.setting});return o.length?r.filter(function(e){return!!e.setting}).concat(o.reduce(function(e,t){return e.merge(t),e})):r}}],[{key:"create",value:function(e,t){return new n(e,t)}}]),n}(u.AbstractCompiler);t.type=u.NodeType.Tag;var h=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],n=function(e){function i(){return a(this,i),l(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return c(i,t),s(i,[{key:"selfClosing",value:function(){return!0}}],[{key:"create",value:function(e,t){var n=e;if(n.name&&-1!==h.indexOf(n.name))return new i(n,t)}}]),i}(),f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},i=function(e){function n(){return a(this,n),l(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return c(n,e),s(n,[{key:"compile",value:function(n){var i=this;if(this.node.text.length){var r=this.escape(),e=this.node.text.filter(function(e){return!!e.length});this.inline()||n.eol(),e.forEach(function(e){var t=e.map(function(e){return e.toHTMLString()}).join("");t.length&&(i.inline()||n.indent(),n.push(r?t.replace(/[&<>"'`=\/]/g,function(e){return f[e]}):t)),n.eol()}),n.pop()}}},{key:"escape",value:function(){return"escape"===this.node.namespace}},{key:"inline",value:function(){return"inline"===this.node.namespace}}],[{key:"create",value:function(e,t){if("|"===e.name)return new n(e,t)}}]),n}(u.AbstractCompiler);i.type=u.NodeType.Tag;var p=function(e){function n(){return a(this,n),l(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return c(n,t),s(n,[{key:"tagOpen",value:function(e){e.eol().indent().push("\x3c!--"),this.inline()&&e.push(" ")}},{key:"tagClose",value:function(e){e.haveIndent&&e.eol().indent(),this.inline()&&e.push(" "),e.push("--\x3e")}},{key:"inline",value:function(){var e=this.node.children[0];return e&&"inline"===e.namespace}}],[{key:"create",value:function(e,t){if("#"===e.name)return new n(e,t)}}]),n}(),d=function(e){function n(){return a(this,n),l(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return c(n,t),s(n,[{key:"compile",value:function(e){e.eol().indent().push("<!DOCTYPE html>")}}],[{key:"create",value:function(e,t){if("doctype"===e.name)return new n(e,t)}}]),n}(),v=function(e){function r(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];a(this,r);var i=l(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));return i.closeIt=n,i}return c(r,t),s(r,null,[{key:"create",value:function(e,t){var n=e;return"ieif"===n.name?new r(n,t,!1):"@ieif"===n.name?new r(n,t,!0):void 0}}]),s(r,[{key:"openStart",value:function(e){e.eol().indent().push("\x3c!--[if ")}},{key:"openEnd",value:function(e){e.push(this.closeIt?"]>\x3c!--\x3e":"]>")}},{key:"attributes",value:function(e){if(this.node.attributeGroups.length){var t=this.node.attributeGroups[0].attributes[0];if(t&&t.values[0]&&t.values[0]instanceof u.StringValue){var n=t.values[0];e.push(n.value)}}}},{key:"tagClose",value:function(e){e.haveIndent&&e.eol().indent(),e.push(this.closeIt?"\x3c!--<![endif]--\x3e":"<![endif]--\x3e")}}]),r}(),y=function(e){function n(){return a(this,n),l(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return c(n,t),s(n,[{key:"compile",value:function(r){var o=this;this.node.attributeGroups.length&&(r.eol().indent(),this.node.attributeGroups.forEach(function(i){return i.attributes.forEach(function(n){return n.values.forEach(function(e){var t=o.stack.concat([i,n]);r.compileUp(e,t)})})}))}}],[{key:"create",value:function(e,t){if("echo"===e.name)return new n(e,t)}}]),n}(),m=function(){function t(e){a(this,t),this.value=e}return s(t,[{key:"compile",value:function(e){e.push(this.value.value)}}]),t}(),g=function(e){function t(){return a(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,m),s(t,null,[{key:"create",value:function(e){return new t(e)}}]),t}();g.type=u.NodeType.StringValue;var b=function(e){function t(){return a(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,m),s(t,null,[{key:"create",value:function(e){return new t(e)}}]),t}();b.type=u.NodeType.BooleanValue;var _=function(e){function t(){return a(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,m),s(t,null,[{key:"create",value:function(e){return new t(e)}}]),t}();_.type=u.NodeType.NumberValue;var k=function(e){function t(){return a(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,m),s(t,null,[{key:"create",value:function(e){return new t(e)}}]),t}();k.type=u.NodeType.IdentifierValue;var O=function(e){function n(){return a(this,n),l(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return c(n,e),s(n,[{key:"compile",value:function(i){var r=this;this.node.attributes.forEach(function(e,t){var n=i.compile(e,r.stack);n&&(t&&i.push(" "),n.mergeUp())})}}],[{key:"create",value:function(e,t){return new n(e,t)}}]),n}(u.AbstractCompiler);O.type=u.NodeType.AttributeGroup;var w=function(e){function n(){return a(this,n),l(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return c(n,e),s(n,[{key:"compile",value:function(e){var t=this.key(e),n=this.value(e);t||(t=n),e.push(t).push('="').push(n).push('"')}},{key:"key",value:function(e){var t="";return this.node.namespace&&this.node.name&&(t+=this.node.namespace+":"),this.node.name&&(t+=this.node.name),t}},{key:"value",value:function(n){var i=this,e=this.node.values.map(function(e){var t=n.compile(e,i.stack);return t?t.getOutput():""});return"class"===this.node.name?e.join(" "):e.join("")}}],[{key:"create",value:function(e,t){return new n(e,t)}}]),n}(u.AbstractCompiler);w.type=u.NodeType.Attribute;var x=function(e){function n(){return a(this,n),l(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return c(n,t),s(n,[{key:"compile",value:function(t){var n=this,e=t.options.sourceFile||o.resolve(".");r.statSync(e).isFile()&&(e=o.dirname(e));var i=o.resolve(e,this.getPath());u.parse(r.readFileSync(i,"utf-8")).nodes.forEach(function(e){return t.compileUp(e,n.stack,-1)})}},{key:"getPath",value:function(){if(this.node.attributeGroups.length){var e=this.node.attributeGroups[0].attributes[0].values[0];if(e){if(e instanceof u.StringValue)return e.value;if(e instanceof u.IdentifierValue)return e.value}}var t=this.node.location.start,n=t.line,i=t.column;throw new SyntaxError("no file specified, line: "+n+" column: "+i)}}],[{key:"create",value:function(e,t){if("@include"===e.name)return new n(e,t)}}]),n}(),j=function(e){function n(){return a(this,n),l(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return c(n,t),s(n,[{key:"compile",value:function(e){if(!this.node.hash)throw new Error("Hash property is required for mixin definition. eg. @mixin#name");if(0!==this.node.indent)throw new Error("Mixin definition must be placed in top level(the indent of it must be 0)");if(e.note.mixin||(e.note.mixin={}),e.note.mixin[this.node.hash])throw new Error("Mixin definition #"+this.node.hash+" have already defined");e.note.mixin[this.node.hash]={nodes:this.node.children,replacement:this.replacement(e)}}},{key:"replacement",value:function(u){var a=this;return this.node.attributeGroups.length?this.node.attributeGroups[0].attributes.reduce(function(e,t){var n=t.values[0];if(!n)return e;var i=a.stack.concat([a.node.attributeGroups[0],t]),r=u.compile(n,i);if(!r)return e;var o=r.getOutput();return t.name?e[t.name]=o:e[o]=null,e},{}):{}}}],[{key:"create",value:function(e,t){if("@mixin"===e.name)return new n(e,t)}}]),n}(),E=function(e){function n(){return a(this,n),l(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return c(n,j),s(n,[{key:"compile",value:function(e){var t=this;if(!this.node.hash)throw new Error("Hash property is required for mixin reference. eg. mixin#name");if(!e.note.mixin||!e.note.mixin[this.node.hash])throw new Error("Mixin #"+this.node.hash+" is not defined");var n=e.note.mixin[this.node.hash],i=e.sub();n.nodes.forEach(function(e){return i.compileUp(e,t.stack,-2)});var r=i.getOutput(),o=Object.assign({},n.replacement,this.replacement(e)),u=Object.keys(o).reduce(function(e,t){return e.replace(new RegExp("\\$"+t,"g"),o[t])},r);e.push(u)}}],[{key:"create",value:function(e,t){if("mixin"===e.name)return new n(e,t)}}]),n}(),P={prepare:function(e){e.register(t,i,n,p,d,v,y,j,E),e.register(g,b,_,k),e.register(O,w),e.register(x)},compile:function(e,t,n){var i=e.nodes,r=e.declaration;return i.forEach(function(e){return n.compileUp(e,new u.SleetStack,-1)}),{code:n.getOutput(),extension:r&&r.extension||"html"}}};e.plugin=P,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=sleet-html.min.js.map
