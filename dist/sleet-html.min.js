!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("sleet"),require("fs"),require("path")):"function"==typeof define&&define.amd?define(["exports","sleet","fs","path"],e):e(t.SleetHTML={},t.Sleet,t.NODE_FS,t.NODE_PATH)}(this,function(t,u,r,o){"use strict";var a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),e=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},h=function(){function n(t,e){a(this,n),this.tag=t,this.stack=e.concat(t)}return s(n,[{key:"compile",value:function(t){this.tagOpen(t),this.content(t),this.tagClose(t)}},{key:"tagOpen",value:function(t){this.openStart(t),this.attributes(t),this.openEnd(t)}},{key:"openStart",value:function(t){t.eol().indent().push("<"),this.tag.namespace&&t.push(this.tag.namespace).push(":"),t.push(this.tag.name||"div")}},{key:"attributes",value:function(n){var i=this,t=this.mergeAttributeGroup.apply(this,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}([this.dotsAndHash()].concat(this.tag.attributeGroups)));t.length&&n.push(" ");var r=n.sub();t.forEach(function(t){var e=n.create(t,[i.tag]);e&&e.compile(r)}),r.mergeUp()}},{key:"openEnd",value:function(t){t.push(">")}},{key:"content",value:function(n){var i=this;this.selfClosing()||this.tag.children.forEach(function(t){var e=n.compile(t,i.stack);e&&e.mergeUp()})}},{key:"tagClose",value:function(t){this.selfClosing()||(t.haveIndent&&t.eol().indent(),t.push("</"),this.tag.namespace&&t.push(this.tag.namespace).push(":"),t.push(this.tag.name||"div").push(">"))}},{key:"selfClosing",value:function(){return!1}},{key:"dotsAndHash",value:function(){if(!this.tag.hash&&!this.tag.dots.length)return null;var t=this.tag.location.start,e=void 0;e=this.tag.attributeGroups.length?this.tag.attributeGroups[0].location.start:this.tag.location.end;var n={start:{offset:t.offset,line:t.line,column:t.column},end:{offset:e.offset,line:e.line,column:e.column}},i=[];if(this.tag.hash){var r=[new u.StringValue(this.tag.hash,n)];i.push(new u.Attribute(void 0,"id",r,n))}if(this.tag.dots.length){var o=this.tag.dots.map(function(t){return new u.StringValue(t,n)});i.push(new u.Attribute(void 0,"class",o,n))}return new u.AttributeGroup(i,void 0,n)}},{key:"mergeAttributeGroup",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e.filter(function(t){return!!t});return i.length?[i.reduce(function(t,e){return t.merge(e,!0),t})]:[]}}],[{key:"create",value:function(t,e){return new n(t,e)}}]),n}();h.type=u.NodeType.Tag;var l=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],n=function(t){function i(){return a(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return e(i,h),s(i,[{key:"selfClosing",value:function(){return!0}}],[{key:"create",value:function(t,e){var n=t;if(n.name&&-1!==l.indexOf(n.name))return new i(n,e)}}]),i}(),f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},i=function(){function n(t){a(this,n),this.tag=t}return s(n,[{key:"compile",value:function(n){var e=this;if(this.tag.text.length){var i=this.escape(),t=this.tag.text.filter(function(t){return!!t.length});this.inline()||n.eol(),t.forEach(function(t){t.some(function(t){return!!t.toHTMLString().length})&&(e.inline()||n.indent(),t.forEach(function(t){var e=t.toHTMLString();n.push(i?e.replace(/[&<>"'`=\/]/g,function(t){return f[t]}):e)})),n.eol()}),n.pop()}}},{key:"escape",value:function(){return"escape"===this.tag.namespace}},{key:"inline",value:function(){return"inline"===this.tag.namespace}}],[{key:"create",value:function(t,e){if("|"===t.name)return new n(t)}}]),n}();i.type=u.NodeType.Tag;var p=function(t){function n(){return a(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e(n,h),s(n,[{key:"tagOpen",value:function(t){t.eol().indent().push("\x3c!--"),this.inline()&&t.push(" ")}},{key:"tagClose",value:function(t){t.haveIndent&&t.eol().indent(),this.inline()&&t.push(" "),t.push("--\x3e")}},{key:"inline",value:function(){var t=this.tag.children[0];return t&&"inline"===t.namespace}}],[{key:"create",value:function(t,e){if("#"===t.name)return new n(t,e)}}]),n}(),v=function(t){function n(){return a(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e(n,h),s(n,[{key:"compile",value:function(t){t.eol().indent().push("<!DOCTYPE html>")}}],[{key:"create",value:function(t,e){if("doctype"===t.name)return new n(t,e)}}]),n}(),g=function(t){function r(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];a(this,r);var i=c(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,e));return i.closeIt=n,i}return e(r,h),s(r,null,[{key:"create",value:function(t,e){var n=t;return"ieif"===n.name?new r(n,e,!1):"@ieif"===n.name?new r(n,e,!0):void 0}}]),s(r,[{key:"openStart",value:function(t){t.eol().indent().push("\x3c!--[if ")}},{key:"openEnd",value:function(t){t.push(this.closeIt?"]>\x3c!--\x3e":"]>")}},{key:"attributes",value:function(t){if(this.tag.attributeGroups.length){var e=this.tag.attributeGroups[0].attributes[0];if(e&&e.values[0]&&e.values[0]instanceof u.StringValue){var n=e.values[0];t.push(n.value)}}}},{key:"tagClose",value:function(t){t.haveIndent&&t.eol().indent(),t.push(this.closeIt?"\x3c!--<![endif]--\x3e":"<![endif]--\x3e")}}]),r}(),y=function(t){function n(){return a(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e(n,h),s(n,[{key:"compile",value:function(o){var u=this;this.tag.attributeGroups.length&&(o.eol().indent(),this.tag.attributeGroups.forEach(function(r){return r.attributes.forEach(function(i){return i.values.forEach(function(t){var e=u.stack.concat(r,i),n=o.compile(t,e);n&&n.mergeUp()})})}))}}],[{key:"create",value:function(t,e){if("echo"===t.name)return new n(t,e)}}]),n}(),m=function(){function e(t){a(this,e),this.value=t}return s(e,[{key:"compile",value:function(t){t.push(this.value.value)}}]),e}(),d=function(t){function n(){return a(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e(n,m),s(n,null,[{key:"create",value:function(t,e){return new n(t)}}]),n}();d.type=u.NodeType.StringValue;var b=function(t){function n(){return a(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e(n,m),s(n,null,[{key:"create",value:function(t,e){return new n(t)}}]),n}();b.type=u.NodeType.BooleanValue;var k=function(t){function n(){return a(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e(n,m),s(n,null,[{key:"create",value:function(t,e){return new n(t)}}]),n}();k.type=u.NodeType.NumberValue;var _=function(t){function n(){return a(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e(n,m),s(n,null,[{key:"create",value:function(t,e){return new n(t)}}]),n}();_.type=u.NodeType.IdentifierValue;var w=function(){function n(t,e){a(this,n),this.group=t,this.stack=e}return s(n,[{key:"compile",value:function(i){var r=this.stack.concat(this.group);this.group.attributes.forEach(function(t,e){var n=i.compile(t,r);n&&(e&&i.push(" "),n.mergeUp())})}}],[{key:"create",value:function(t,e){return new n(t,e)}}]),n}();w.type=u.NodeType.AttributeGroup;var O=function(){function n(t,e){a(this,n),this.node=t,this.stack=e.concat(t)}return s(n,[{key:"compile",value:function(t){var e=this.key(t),n=this.value(t);e||(e=n),t.push(e).push('="').push(n).push('"')}},{key:"key",value:function(t){var e="";return this.node.namespace&&this.node.name&&(e+=this.node.namespace+":"),this.node.name&&(e+=this.node.name),e}},{key:"value",value:function(n){var i=this,t=this.node.values.map(function(t){var e=n.compile(t,i.stack);return e?e.getOutput():""});return"class"===this.node.name?t.join(" "):t.join("")}}],[{key:"create",value:function(t,e){return new n(t,e)}}]),n}();O.type=u.NodeType.Attribute;var x=function(t){function n(){return a(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e(n,h),s(n,[{key:"compile",value:function(n){var i=this,t=n.options.sourceFile||o.resolve(".");r.statSync(t).isFile()&&(t=o.dirname(t));var e=o.resolve(t,this.getPath());u.parse(r.readFileSync(e,"utf-8")).nodes.forEach(function(t){var e=n.compile(t,i.stack,-1);e&&e.mergeUp()})}},{key:"getPath",value:function(){if(this.tag.attributeGroups.length){var t=this.tag.attributeGroups[0].attributes[0].values[0];if(t){if(t instanceof u.StringValue)return t.value;if(t instanceof u.IdentifierValue)return t.value}}var e=this.tag.location.start,n=e.line,i=e.column;throw new SyntaxError("no file specified, line: "+n+" column: "+i)}}],[{key:"create",value:function(t,e){if("@include"===t.name)return new n(t,e)}}]),n}(),E=function(t){function n(){return a(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e(n,h),s(n,[{key:"compile",value:function(t){if(!this.tag.hash)throw new Error("Hash property is required for mixin definition. eg. @mixin#name");if(0!==this.tag.indent)throw new Error("Mixin definition must be placed in top level(the indent of it must be 0)");if(t.note.mixin||(t.note.mixin={}),t.note.mixin[this.tag.hash])throw new Error("Mixin definition #"+this.tag.hash+" have already defined");t.note.mixin[this.tag.hash]={nodes:this.tag.children,replacement:this.replacement(t)}}},{key:"replacement",value:function(u){var a=this;return this.tag.attributeGroups.length?this.tag.attributeGroups[0].attributes.reduce(function(t,e){var n=e.values[0];if(!n)return t;var i=a.stack.concat(a.tag.attributeGroups[0],e),r=u.compile(n,i);if(!r)return t;var o=r.getOutput();return e.name?t[e.name]=o:t[o]=null,t},{}):{}}}],[{key:"create",value:function(t,e){if("@mixin"===t.name)return new n(t,e)}}]),n}(),j=function(t){function n(){return a(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e(n,E),s(n,[{key:"compile",value:function(t){var n=this;if(!this.tag.hash)throw new Error("Hash property is required for mixin reference. eg. mixin#name");if(!t.note.mixin||!t.note.mixin[this.tag.hash])throw new Error("Mixin #"+this.tag.hash+" is not defined");var e=t.note.mixin[this.tag.hash],i=t.sub();e.nodes.forEach(function(t){var e=i.compile(t,n.stack,-2);e&&e.mergeUp()});var r=i.getOutput(),o=Object.assign({},e.replacement,this.replacement(t)),u=Object.keys(o).reduce(function(t,e){return t.replace(new RegExp("\\$"+e,"g"),o[e])},r);t.push(u)}}],[{key:"create",value:function(t,e){if("mixin"===t.name)return new n(t,e)}}]),n}(),P={prepare:function(t){t.register(h,i,n,p,v,g,y,E,j),t.register(d,b,k,_),t.register(w,O),t.register(x)},compile:function(t,e,n){var i=t.nodes,r=t.declaration;return i.forEach(function(t){var e=n.compile(t,[],-1);e&&e.mergeUp()}),{code:n.getOutput(),extension:r&&r.extension||"html"}}};t.plugin=P,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=sleet-html.min.js.map
